---
title: "open-format-forest-height"
output: html_document
date: "2023-08-30"
---

```{r, message=FALSE}
library(terra)
library(sf)

library(ggplot2)
library(ggspatial)
library(tidyterra)
library(rgeos)
library(data.table) # -- for large flat datasets
library(DT)

# -- for timeseries
library(lubridate)
library(xts)
```


Open raw file of forest height on US 

```{r}
forest <- rast('../input/US_forest_height_2019.tif')
crs(forest)
```

Extract NC borders

```{r}
nc.borders <- vect("../input/NC_county_boundary/North_Carolina_State_and_County_Boundary_Polygons.shp") 
nc.borders <- project(nc.borders, crs(forest))
nc.forest <- terra::crop(forest, nc.borders)
```

Project on crs.meters

```{r}
crs.meters <- "+proj=lcc +lat_0=33.75 +lon_0=-79 +lat_1=36.1666666666667 +lat_2=34.3333333333333 +x_0=609601.219202439 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
nc.forest.meters <- project(nc.forest, crs.meters)
```

Save all final files

```{r}
writeRaster(nc.forest, filename="../input/NC_forest_height_2019_crs-wgs84.tif", overwrite=T)
writeRaster(nc.forest.meters, filename=paste0("../input/NC_forest_height_2019_crs-meters.tif"), overwrite=T)
```

